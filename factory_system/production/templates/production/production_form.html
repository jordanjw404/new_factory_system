{% extends "core/base.html" %}
{% load widget_tweaks %}
{% block content %}

<div class="container mt-4">
  <h2>Create New Production Stage</h2>

  <form method="post" class="card p-4 shadow-sm">
    {% csrf_token %}

    <h5 class="text-primary">üîó Link to Order</h5>
    <div class="form-floating mb-3">
      <select name="order" id="id_order" class="form-select form-select-sm" onchange="this.form.submit()">

        <option value="">Select an Order</option>
        {% for order in orders %}
          <option value="{{ order.id }}" 
                  data-ref="{{ order.reference }}"
                  data-customer="{{ order.customer.name }}"
                  data-delivery="{{ order.delivery_date }}">
            {{ order.reference }} - {{ order.customer.name }}
          </option>
        {% endfor %}
      </select>
      <label for="id_order">Order</label>
    </div>
    

    <div id="orderInfo" class="alert alert-secondary mt-3 d-none">
      <p><strong>Reference:</strong> <span id="orderReference"></span></p>
      <p><strong>Customer:</strong> <span id="orderCustomer"></span></p>
      <p><strong>Due Date:</strong> <span id="orderDeliveryDate"></span></p>
    </div>

    <hr>

    <h5 class="text-primary">üõ† Stage Status</h5>
    <div class="row g-2">
      <div class="col-md-6">{{ form.sales_status|add_class:"form-select form-select-sm" }}</div>
      <div class="col-md-6">{{ form.programming_status|add_class:"form-select form-select-sm" }}</div>
      <div class="col-md-6">{{ form.nest_status|add_class:"form-select form-select-sm" }}</div>
      <div class="col-md-6">{{ form.edge_status|add_class:"form-select form-select-sm" }}</div>
      <div class="col-md-6">{{ form.prep_status|add_class:"form-select form-select-sm" }}</div>
      <div class="col-md-6">{{ form.build_status|add_class:"form-select form-select-sm" }}</div>
      <div class="col-md-6">{{ form.fittings_status|add_class:"form-select form-select-sm" }}</div>
      <div class="col-md-6">{{ form.wrapping_status|add_class:"form-select form-select-sm" }}</div>
      <div class="col-md-6">{{ form.quality_status|add_class:"form-select form-select-sm" }}</div>
    </div>

    <hr>

    <h5 class="text-primary">üéØ Target Dates</h5>
    <div class="row g-2">
      <div class="col-md-6 form-floating mb-3">
        {{ form.sales_target_date|add_class:"form-control form-control-sm" }}
        <label for="{{ form.sales_target_date.id_for_label }}">Sales Target Date</label>
      </div>
      <div class="col-md-6 form-floating mb-3">
        {{ form.programming_target_date|add_class:"form-control form-control-sm" }}
        <label for="{{ form.programming_target_date.id_for_label }}">Programming Target Date</label>
      </div>
      <div class="col-md-6 form-floating mb-3">
        {{ form.nest_target_date|add_class:"form-control form-control-sm" }}
        <label for="{{ form.nest_target_date.id_for_label }}">Nest Target Date</label>
      </div>
      <div class="col-md-6 form-floating mb-3">
        {{ form.edge_target_date|add_class:"form-control form-control-sm" }}
        <label for="{{ form.edge_target_date.id_for_label }}">Edge Target Date</label>
      </div>
      <div class="col-md-6 form-floating mb-3">
        {{ form.prep_target_date|add_class:"form-control form-control-sm" }}
        <label for="{{ form.prep_target_date.id_for_label }}">Prep Target Date</label>
      </div>
      <div class="col-md-6 form-floating mb-3">
        {{ form.build_target_date|add_class:"form-control form-control-sm" }}
        <label for="{{ form.build_target_date.id_for_label }}">Build Target Date</label>
      </div>
      <div class="col-md-6 form-floating mb-3">
        {{ form.fittings_target_date|add_class:"form-control form-control-sm" }}
        <label for="{{ form.fittings_target_date.id_for_label }}">Fittings Target Date</label>
      </div>
      <div class="col-md-6 form-floating mb-3">
        {{ form.wrapping_target_date|add_class:"form-control form-control-sm" }}
        <label for="{{ form.wrapping_target_date.id_for_label }}">Wrapping Target Date</label>
      </div>
      <div class="col-md-6 form-floating mb-3">
        {{ form.quality_target_date|add_class:"form-control form-control-sm" }}
        <label for="{{ form.quality_target_date.id_for_label }}">Quality Target Date</label>
      </div>
    </div>
    

    <hr>

    <h5 class="text-primary">üìè Workload Estimation</h5>
    <div class="row g-2">
      <div class="col-md-4">
        {{ form.estimated_nest_sheets.label_tag }}
        {{ form.estimated_nest_sheets|add_class:"form-control form-control-sm" }}
      </div>
      <div class="col-md-4">
        {{ form.estimated_build_cabs.label_tag }}
        {{ form.estimated_build_cabs|add_class:"form-control form-control-sm" }}
      </div>
      <div class="col-md-4">
        {{ form.actual_nest_sheets.label_tag }}
        {{ form.actual_nest_sheets|add_class:"form-control form-control-sm" }}
      </div>
    </div>

    <button type="submit" class="btn btn-success w-100 mt-4">Save Production Stage</button>
  </form>

  <a href="{% url 'production:production_list' %}" class="btn btn-secondary mt-3">‚Üê Back to Production List</a>
</div>

{% endblock %}
